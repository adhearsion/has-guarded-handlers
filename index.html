<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>has-guarded-handlers by adhearsion</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/adhearsion/has-guarded-handlers">Fork On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/adhearsion/has-guarded-handlers/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/adhearsion/has-guarded-handlers/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>has-guarded-handlers</h1>
          <p>Add event handlers to your Ruby objects, and guard them against unnecessary invokation </p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/adhearsion">adhearsion</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></span>
        </div>

        <h3>What is it for?</h3>

<p>HasGuardedHandlers allows an object's API to provide flexible handler registration, storage and matching to arbitrary events.</p>

<h3>How do I use it?</h3>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'has_guarded_handlers'</span>

<span class="k">class</span> <span class="nc">A</span>
  <span class="kp">include</span> <span class="no">HasGuardedHandlers</span>
<span class="k">end</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">new</span>
<span class="n">a</span><span class="o">.</span><span class="n">register_handler</span> <span class="ss">:event</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:foo</span> <span class="k">do</span> <span class="o">|</span><span class="n">event</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"Handled the event of type </span><span class="si">#{</span><span class="n">event</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2"> with value </span><span class="si">#{</span><span class="n">event</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>

<span class="no">Event</span> <span class="o">=</span> <span class="no">Class</span><span class="o">.</span><span class="n">new</span> <span class="no">Struct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:type</span><span class="p">,</span> <span class="ss">:value</span><span class="p">)</span>

<span class="n">a</span><span class="o">.</span><span class="n">trigger_handler</span> <span class="ss">:event</span><span class="p">,</span> <span class="no">Event</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:foo</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">)</span>
</pre>
</div>


<p>Register a handler for a particular named channel:</p>

<div class="highlight">
<pre><span class="n">a</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span><span class="ss">:event</span><span class="p">)</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span>
<span class="c1"># or</span>
<span class="n">a</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span><span class="ss">:event</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:foo</span><span class="p">)</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span>

<span class="n">a</span><span class="o">.</span><span class="n">trigger_handler</span> <span class="ss">:event</span><span class="p">,</span> <span class="ss">:foo</span>
</pre>
</div>


<p>Register a global handler for all channels:</p>

<div class="highlight">
<pre><span class="n">a</span><span class="o">.</span><span class="n">register_handler</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span>
<span class="c1"># or</span>
<span class="n">a</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span><span class="kp">nil</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:foo</span><span class="p">)</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span>

<span class="n">a</span><span class="o">.</span><span class="n">trigger_handler</span> <span class="ss">:event</span><span class="p">,</span> <span class="ss">:foo</span>
</pre>
</div>


<p>Register a temporary handler, which is deleted once triggered:</p>

<div class="highlight">
<pre><span class="n">a</span><span class="o">.</span><span class="n">register_tmp_handler</span><span class="p">(</span><span class="ss">:event</span><span class="p">)</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span> <span class="c1"># This will only fire once</span>
<span class="n">a</span><span class="o">.</span><span class="n">trigger_handler</span> <span class="ss">:event</span><span class="p">,</span> <span class="ss">:foo</span>
</pre>
</div>


<p>Handlers are triggered in order of priority, followed by order of declaration. By default, all handlers are registered with priority 0, and are thus executed in the order declared:</p>

<div class="highlight">
<pre><span class="n">a</span><span class="o">.</span><span class="n">register_handler</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span> <span class="c1"># This is triggered first</span>
<span class="n">a</span><span class="o">.</span><span class="n">register_handler</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span> <span class="c1"># This is triggered second</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>

<span class="n">a</span><span class="o">.</span><span class="n">trigger_handler</span> <span class="ss">:event</span><span class="p">,</span> <span class="ss">:foo</span>
</pre>
</div>


<p>You may specify a handler priority in order to change this order. Higher priority is executed first:</p>

<div class="highlight">
<pre><span class="n">a</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span><span class="ss">:event</span><span class="p">)</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span> <span class="c1"># This is triggered second</span>
<span class="n">a</span><span class="o">.</span><span class="n">register_handler_with_priority</span><span class="p">(</span><span class="ss">:event</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span> <span class="c1"># This is triggered first</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>

<span class="n">a</span><span class="o">.</span><span class="n">trigger_handler</span> <span class="ss">:event</span><span class="p">,</span> <span class="ss">:foo</span>
</pre>
</div>


<p>You may specify a priority for a temporary handler:</p>

<div class="highlight">
<pre><span class="n">a</span><span class="o">.</span><span class="n">register_handler_with_options</span><span class="p">(</span><span class="ss">:event</span><span class="p">,</span> <span class="p">{</span><span class="ss">:tmp</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:priority</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">},</span> <span class="ss">:foo</span> <span class="o">=&gt;</span> <span class="ss">:bar</span><span class="p">)</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span>
</pre>
</div>


<h3>Handler chaining</h3>

<p>When multiple handlers match the event, the return value of each handler will determine if the handler chain continues. A truthy return value will cause the handler to swallow the event and halt the handler chain. A falsy return value will continue the chain.</p>

<p>It is possible to explicitly pass to the next handler by throwing <code>:pass</code> in your handler:</p>

<div class="highlight">
<pre><span class="n">a</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span><span class="ss">:event</span><span class="p">)</span> <span class="p">{</span> <span class="kp">throw</span> <span class="ss">:pass</span> <span class="p">}</span>
<span class="n">a</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span><span class="ss">:event</span><span class="p">)</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span> <span class="c1"># This will be executed</span>

<span class="n">a</span><span class="o">.</span><span class="n">trigger_handler</span> <span class="ss">:event</span><span class="p">,</span> <span class="ss">:foo</span>
</pre>
</div>


<p>or indeed explicitly halt the handler chain by throwing <code>:halt</code> in the handler:</p>

<div class="highlight">
<pre><span class="n">a</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span><span class="ss">:event</span><span class="p">)</span> <span class="p">{</span> <span class="kp">throw</span> <span class="ss">:halt</span> <span class="p">}</span>
<span class="n">a</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span><span class="ss">:event</span><span class="p">)</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span> <span class="c1"># This will not be executed</span>

<span class="n">a</span><span class="o">.</span><span class="n">trigger_handler</span> <span class="ss">:event</span><span class="p">,</span> <span class="ss">:foo</span>
</pre>
</div>


<h3>What are guards?</h3>

<p>Guards are a concept borrowed from Erlang. They help to better compartmentalise handlers.</p>

<p>There are a number of guard types and one bit of special syntax. Guards act like AND statements. Each condition must be met if the handler is to be used.</p>

<div class="highlight">
<pre><span class="c1"># Equivalent to saying (event.chat? &amp;&amp; event.body)</span>
<span class="n">register_handler</span> <span class="ss">:chat?</span><span class="p">,</span> <span class="ss">:body</span>
</pre>
</div>


<p>The different types of guards are:</p>

<div class="highlight">
<pre><span class="c1"># Class / Module</span>
<span class="c1">#   Checks that the event is of the type specified</span>
<span class="c1">#   Equivalent to event.is_a? Foo</span>
<span class="n">register_handler</span> <span class="no">Foo</span>

<span class="c1"># Symbol</span>
<span class="c1">#   Checks for a non-false reply to calling the symbol on the event</span>
<span class="c1">#   Equivalent to event.chat?</span>
<span class="n">register_handler</span> <span class="ss">:chat?</span>

<span class="c1"># Hash with any value (:body =&gt; 'exit')</span>
<span class="c1">#   Calls the key on the event and checks for equality</span>
<span class="c1">#   Equivalent to event.body == 'exit'</span>
<span class="n">register_handler</span> <span class="ss">:body</span> <span class="o">=&gt;</span> <span class="s1">'exit'</span>

<span class="c1"># Hash with regular expression (:body =&gt; /exit/)</span>
<span class="c1">#   Calls the key on the event and checks for a match</span>
<span class="c1">#   Equivalent to event.body.match /exit/</span>
<span class="n">register_handler</span> <span class="ss">:body</span> <span class="o">=&gt;</span> <span class="sr">/exit/</span>

<span class="c1"># Hash with array value (:name =&gt; [:gone, :forbidden])</span>
<span class="c1">#   Calls the key on the event and check for inclusion in the array</span>
<span class="c1">#   Equivalent to [:gone, :forbidden].include?(event.name)</span>
<span class="n">register_handler</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:gone</span><span class="p">,</span> <span class="ss">:fobidden</span><span class="o">]</span>

<span class="c1"># Hash with array key ([:[], :name] =&gt; :gone)</span>
<span class="c1">#   Calls the first element of the key on the event, passing the other elements as arguments</span>
<span class="c1">#   and checks the value matches</span>
<span class="c1">#   Equivalent to event[:name] == :gone</span>
<span class="n">register_handler</span> <span class="o">[</span><span class="ss">:[]</span><span class="p">,</span> <span class="ss">:name</span><span class="o">]</span> <span class="o">=&gt;</span> <span class="ss">:gone</span>

<span class="c1"># Proc</span>
<span class="c1">#   Calls the proc passing in the event</span>
<span class="c1">#   Checks that the ID is modulo 3</span>
<span class="n">register_handler</span> <span class="nb">proc</span> <span class="p">{</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="n">m</span><span class="o">.</span><span class="n">id</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">}</span>

<span class="c1"># Array</span>
<span class="c1">#   Use arrays with the previous types effectively turns the guard into</span>
<span class="c1">#   an OR statement.</span>
<span class="c1">#   Equivalent to event.body == 'foo' || event.body == 'baz'</span>
<span class="n">register_handler</span> <span class="o">[</span><span class="p">{</span><span class="ss">:body</span> <span class="o">=&gt;</span> <span class="s1">'foo'</span><span class="p">},</span> <span class="p">{</span><span class="ss">:body</span> <span class="o">=&gt;</span> <span class="s1">'baz'</span><span class="p">}</span><span class="o">]</span>
</pre>
</div>


<h3>Authors and Contributors</h3>

<ul>
<li><a href="https://github.com/sprsquish" class="user-mention">@sprsquish</a></li>
<li><a href="https://github.com/benlangfeld" class="user-mention">@benlangfeld</a></li>
</ul>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
  </body>
</html>